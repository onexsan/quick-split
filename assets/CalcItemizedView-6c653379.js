import{i as T,j as q,k as x,r as k,d as $,s as z,l as P,m as W,h as v,o as u,g as h,a as f,w as I,n as H,e as g,F as w,p as D,u as _,t as V,v as O,q as G,f as B,c as S,b as A,_ as R}from"./index-106900df.js";import{u as J}from"./calc.scss_vue_type_style_index_0_src_true_lang-8cac571f.js";const K={name:"Friend 1",debts:[],id:Date.now()},Q={itemName:"Item 1",price:0,debt:0,itemId:0,includedFriends:[]},N=T("friends",()=>{const n=q([K]),i=x({get(){return n.length},set(){}});return{friendsList:n,friendsNumber:i,changeFriendsList:d=>{d==="add"?n.push({name:`Friend ${n.length+1}`,debts:[],id:Date.now()}):d==="removeLast"&&n.length>1&&n.splice(n.length-1,1)},deleteFriend:d=>{if(n.length>1){const l=n.findIndex(t=>t.id===d);n.splice(l,1)}}}}),U=T("items",()=>{const n=q([{...Q,itemId:Date.now()}]);return{itemList:n,changeItemList:function(o,d){if(o==="add")n.push({itemName:`Item ${n.length+1}`,price:0,debt:0,itemId:Date.now(),includedFriends:[]});else if(o==="remove"&&d&&n.length>1){const l=n.findIndex(t=>t.itemId===d);n.splice(l,1)}},updateItem:o=>{const{id:d,field:l,value:t,debt:s,includedFriends:a}=o,e=n.find(r=>r.itemId===d);e&&(l&&(e[l]=t),s!==void 0&&(e.debt=s),a&&(e.includedFriends=a))}}}),E=T("debts",()=>{const n=N(),i=U(),m=j(),o=x(()=>{const t={};return i.itemList.forEach(s=>{s.includedFriends.forEach(e=>{const r=n.friendsList.find(y=>y.id===e);let b;r&&(b=r.name);const F={itemId:s.itemId,debt:s.debt,itemName:s.itemName};if(!t[e])t[e]={name:b,id:e,debts:[]},t[e].debts.push(F);else{let y=t[e].debts.find(p=>p.itemId===s.itemId);y?y=F:t[e].debts.push(F)}})}),t}),d=x(()=>Object.keys(o.value).map(t=>{const s=o.value[t];return{name:s.name,id:+t,debts:s.debts.reduce((a,e)=>a+=e.debt,0)}}).filter(t=>t.debts!==0&&t.id!==m.payer.id));return{friendsWithDebts:o,simplifiedDebts:d,getFullDebts:t=>o.value[t]}}),j=T("payer",()=>{const n=N(),i=U(),m=E(),o=k(n.friendsList[0]),d=s=>{const a=n.friendsList.find(e=>e.id===s);o.value=a},l=x(()=>i.itemList.reduce((s,a)=>s+=a.price,0)),t=x(()=>m.simplifiedDebts.length?m.simplifiedDebts.reduce((a,e)=>a+=e.debts,0):0);return{payer:o,paidSum:l,returnSum:t,updatePayer:d}}),X={class:"d-flex-center"},Y=g("p",{class:"mr-sm"},"Who pays",-1),Z=["value"],ee=$({__name:"PayerSelector",setup(n){const m=N().friendsList,o=j(),{payer:d}=z(o),l=o.updatePayer,t=k(null);return P(t,s=>{s&&l(s)}),W(()=>{t.value=d.value.id}),(s,a)=>{const e=v("van-row");return u(),h("div",X,[f(e,{align:"center",justify:"space-between"},{default:I(()=>[Y,H(g("select",{class:"selector","onUpdate:modelValue":a[0]||(a[0]=r=>t.value=r)},[(u(!0),h(w,null,D(_(m),r=>(u(),h("option",{key:r.id,value:r.id},V(r.name),9,Z))),128))],512),[[O,t.value]])]),_:1})])}}});const te={class:"friends-block"},ne=g("p",null,"Friends",-1),se={class:"group-wrapper"},oe=$({__name:"FriendsList",setup(n){const i=N(),{friendsNumber:m}=z(i),o=i.friendsList,d=i.changeFriendsList,l=k(!1),t=()=>{l.value=!l.value},s=a=>{i.deleteFriend(a)};return(a,e)=>{const r=v("van-stepper"),b=v("van-button"),F=v("van-row"),y=v("van-field"),p=v("van-form");return u(),h("div",te,[f(F,{class:"d-flex-center mt-base",justify:"center"},{default:I(()=>[ne,f(r,{class:"mt-base",max:"15",modelValue:_(m),"onUpdate:modelValue":e[0]||(e[0]=c=>G(m)?m.value=c:null),"before-change":()=>!1,onPlus:e[1]||(e[1]=c=>_(d)("add")),onMinus:e[2]||(e[2]=c=>_(d)("removeLast"))},null,8,["modelValue","before-change"]),f(ee,{class:"mt-base"}),f(b,{class:"mt-base",size:"mini",onClick:t},{default:I(()=>[B(V(l.value?"Hide":"Edit")+" friends",1)]),_:1})]),_:1}),g("div",se,[l.value?(u(),S(p,{key:0,class:"d-flex-center mt-base"},{default:I(()=>[(u(!0),h(w,null,D(_(o),c=>(u(),S(F,{class:"friends-item",key:c.id,align:"center",justify:"space-between",wrap:!1},{default:I(()=>[f(y,{class:"friends-item__input",required:"",error:!c.name,"left-icon":"friends-o","right-icon":"edit",name:`friend-${c.name}`,placeholder:"Friend name",modelValue:c.name,"onUpdate:modelValue":C=>c.name=C},null,8,["error","name","modelValue","onUpdate:modelValue"]),f(b,{size:"mini",icon:"delete-o",class:"border-none",onClick:C=>s(c.id),disabled:_(o).length<2},null,8,["onClick","disabled"])]),_:2},1024))),128))]),_:1})):A("",!0)])])}}}),ie={class:"delete-row"},de=$({__name:"TableItem",props:{item:null},setup(n){const i=n,o=N().friendsList,d=U(),l=d.itemList,t=d.changeItemList,s=d.updateItem,a=x(()=>J({sum:i.item.price,divideBy:e.value.length})),e=k([]),r=k([]);P(o,()=>{const p=o.filter(c=>!r.value.includes(c.id));e.value=p.map(c=>c.id)},{immediate:!0}),P(a,p=>{s({id:i.item.itemId,debt:p})},{immediate:!0}),P(e,p=>{s({id:i.item.itemId,includedFriends:p})});const b=function(p){e.value.includes(p)?(e.value=e.value.filter(c=>c!==p),r.value.push(p)):(e.value.push(p),r.value=r.value.filter(c=>c===p))},F=()=>{t("remove",i.item.itemId)},y=(p,c)=>{s({id:i.item.itemId,field:p,value:c,debt:a.value,includedFriends:e.value})};return(p,c)=>{const C=v("van-field"),M=v("van-button");return u(),h("tr",null,[g("td",null,[f(C,{modelValue:i.item.itemName,"onUpdate:modelValue":c[0]||(c[0]=L=>y("itemName",L)),"left-icon":"cart-o","right-icon":"edit",placeholder:"Name"},null,8,["modelValue"])]),g("td",null,[f(C,{modelValue:i.item.price,"onUpdate:modelValue":c[1]||(c[1]=L=>y("price",+L)),type:"number",placeholder:"Price"},null,8,["modelValue"])]),(u(!0),h(w,null,D(_(o),L=>(u(),h("td",{key:L.id},[f(M,{type:e.value.includes(L.id)?"primary":"default",size:"mini",class:"debt-btn",onClick:ye=>b(L.id)},{default:I(()=>[B(V(e.value.includes(L.id)?_(a):"-"),1)]),_:2},1032,["type","onClick"])]))),128)),g("td",ie,[f(M,{size:"mini",icon:"delete-o",class:"border-none",onClick:F,disabled:_(l).length<2},null,8,["disabled"])])])}}});const le=R(de,[["__scopeId","data-v-ac7142ce"]]),ae={class:"item-table"},re=g("th",null,"Item",-1),ce=g("th",null,"Price",-1),ue=g("th",null,null,-1),me=$({__name:"AddItemTable",setup(n){const m=N().friendsList,o=U(),d=o.itemList,l=o.changeItemList;return(t,s)=>{const a=v("van-button"),e=v("van-row"),r=v("van-form");return u(),S(r,{class:"add-item-view d-flex-center"},{default:I(()=>[g("table",ae,[g("thead",null,[re,ce,(u(!0),h(w,null,D(_(m),b=>(u(),h("th",{key:b.id},V(b.name),1))),128)),ue]),g("tbody",null,[(u(!0),h(w,null,D(_(d),b=>(u(),S(le,{key:b.itemId,item:b},null,8,["item"]))),128))])]),f(e,{class:"mt-base"},{default:I(()=>[f(a,{icon:"plus",size:"mini",onClick:s[0]||(s[0]=b=>_(l)("add"))},{default:I(()=>[B("Add item")]),_:1})]),_:1})]),_:1})}}});const _e={key:0},pe=$({__name:"DebtItem",props:{friend:null},setup(n){const i=n,m=j(),{payer:o}=z(m),l=E().getFullDebts,t=x(()=>l(i.friend.id));return(s,a)=>{const e=v("van-collapse-item");return u(),S(e,{title:i.friend.name,value:`owes ${i.friend.debts} to ${_(o).name}`,name:i.friend.id},{default:I(()=>[_(t)?(u(),h("ul",_e,[(u(!0),h(w,null,D(_(t).debts,r=>(u(),h("li",{key:r.itemId},V(r.itemName)+" - "+V(r.debt),1))),128))])):A("",!0)]),_:1},8,["title","value","name"])}}}),fe=$({__name:"DebtList",setup(n){const i=j(),m=E(),{payer:o,paidSum:d,returnSum:l}=z(i),{simplifiedDebts:t}=z(m),s=k("accordion");return(a,e)=>{const r=v("van-cell"),b=v("van-collapse"),F=v("van-cell-group");return u(),S(F,{class:"debtor-list mb-base",inset:""},{default:I(()=>[_(d)&&_(l)?(u(),S(r,{key:0,title:`${_(o).name} paid ${_(d)} and gets back ${_(l)}`},null,8,["title"])):A("",!0),f(b,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=y=>s.value=y),accordion:""},{default:I(()=>[(u(!0),h(w,null,D(_(t),y=>(u(),S(pe,{key:y.id,friend:y},null,8,["friend"]))),128))]),_:1},8,["modelValue"])]),_:1})}}});const ve=R(fe,[["__scopeId","data-v-e126c158"]]),be={class:"group-wrapper"},he={class:"group-wrapper mb-base"},ge=$({__name:"ItemizedForm",setup(n){return(i,m)=>{const o=v("van-cell-group"),d=v("van-form");return u(),S(d,{class:"itemized-form"},{default:I(()=>[f(o,{inset:""},{default:I(()=>[f(oe),g("div",be,[f(me)]),g("div",he,[f(ve)])]),_:1})]),_:1})}}});const Se=$({__name:"CalcItemizedView",setup(n){return(i,m)=>(u(),S(ge))}});export{Se as default};
