import{i as W,j as M,k as V,r as z,d as k,s as B,l as j,m as H,h as b,o as l,g as h,a as v,w as $,n as O,e as g,F as D,p as N,u as r,t as T,v as G,q as J,f as A,c as x,b as E,_ as q}from"./index-56f6ee95.js";import{u as K}from"./calc.scss_vue_type_style_index_0_src_true_lang-8cac571f.js";const Q={name:"Friend 1",debts:[],id:Date.now()},X={itemName:"Item 1",price:0,debt:0,itemId:0,includedFriends:[]},P=W("main",()=>{const a=M([Q]),s=V({get(){return a.length},set(){}}),d=e=>{e==="add"?a.push({name:`Friend ${a.length+1}`,debts:[],id:Date.now()}):e==="removeLast"&&a.length>1&&a.splice(a.length-1,1)},_=e=>{if(a.length>1){const t=a.findIndex(m=>m.id===e);a.splice(t,1)}},u=z(a[0]),c=e=>{const t=a.find(m=>m.id===e);u.value=t},p=V(()=>n.reduce((e,t)=>e+=t.price,0)),I=V(()=>F.value.length?F.value.reduce((t,m)=>t+=m.debts,0):0),n=M([{...X,itemId:Date.now()}]),o=function(e,t){if(e==="add")n.push({itemName:`Item ${n.length+1}`,price:0,debt:0,itemId:Date.now(),includedFriends:[]});else if(e==="remove"&&t&&n.length>1){const m=n.findIndex(i=>i.itemId===t);n.splice(m,1)}},y=e=>{const{id:t,field:m,value:i,debt:S,includedFriends:U}=e,w=n.find(C=>C.itemId===t);w&&(m&&(w[m]=i),S!==void 0&&(w.debt=S),U&&(w.includedFriends=U))},L=V(()=>{const e={};return n.forEach(t=>{t.includedFriends.forEach(i=>{const S=a.find(C=>C.id===i);let U;S&&(U=S.name);const w={itemId:t.itemId,debt:t.debt,itemName:t.itemName};if(!e[i])e[i]={name:U,id:i,debts:[]},e[i].debts.push(w);else{let C=e[i].debts.find(R=>R.itemId===t.itemId);C?C=w:e[i].debts.push(w)}})}),e}),F=V(()=>Object.keys(L.value).map(e=>{const t=L.value[e];return{name:t.name,id:+e,debts:t.debts.reduce((m,i)=>m+=i.debt,0)}}).filter(e=>e.debts!==0&&e.id!==u.value.id));return{friendsList:a,friendsNumber:s,changeFriendsList:d,deleteFriend:_,payer:u,paidSum:p,returnSum:I,updatePayer:c,itemList:n,changeItemList:o,updateItem:y,friendsWithDebts:L,simplifiedDebts:F,getFullDebts:e=>L.value[e]}}),Y={class:"d-flex-center"},Z=g("p",{class:"mr-sm"},"Who pays",-1),ee=["value"],te=k({__name:"PayerSelector",setup(a){const s=P(),d=s.friendsList,{payer:_}=B(s),u=s.updatePayer,c=z(null);return j(c,p=>{p&&u(p)}),H(()=>{c.value=_.value.id}),(p,I)=>{const n=b("van-row");return l(),h("div",Y,[v(n,{align:"center",justify:"space-between"},{default:$(()=>[Z,O(g("select",{class:"selector","onUpdate:modelValue":I[0]||(I[0]=o=>c.value=o)},[(l(!0),h(D,null,N(r(d),o=>(l(),h("option",{key:o.id,value:o.id},T(o.name),9,ee))),128))],512),[[G,c.value]])]),_:1})])}}});const ne={class:"friends-block"},se=g("p",null,"Friends",-1),oe={class:"group-wrapper"},le=k({__name:"FriendsList",setup(a){const s=P(),{friendsNumber:d}=B(s),_=s.friendsList,u=s.changeFriendsList,c=z(!1),p=()=>{c.value=!c.value},I=n=>{s.deleteFriend(n)};return(n,o)=>{const y=b("van-stepper"),L=b("van-button"),F=b("van-row"),f=b("van-field"),e=b("van-form");return l(),h("div",ne,[v(F,{class:"d-flex-center mt-base",justify:"center"},{default:$(()=>[se,v(y,{class:"mt-base",max:"15",modelValue:r(d),"onUpdate:modelValue":o[0]||(o[0]=t=>J(d)?d.value=t:null),"before-change":()=>!1,onPlus:o[1]||(o[1]=t=>r(u)("add")),onMinus:o[2]||(o[2]=t=>r(u)("removeLast"))},null,8,["modelValue","before-change"]),v(te,{class:"mt-base"}),v(L,{class:"mt-base",size:"mini",onClick:p},{default:$(()=>[A(T(c.value?"Hide":"Edit")+" friends",1)]),_:1})]),_:1}),g("div",oe,[c.value?(l(),x(e,{key:0,class:"d-flex-center mt-base"},{default:$(()=>[(l(!0),h(D,null,N(r(_),t=>(l(),x(F,{class:"friends-item",key:t.id,align:"center",justify:"space-between",wrap:!1},{default:$(()=>[v(f,{class:"friends-item__input",required:"",error:!t.name,"left-icon":"friends-o","right-icon":"edit",name:`friend-${t.name}`,placeholder:"Friend name",modelValue:t.name,"onUpdate:modelValue":m=>t.name=m},null,8,["error","name","modelValue","onUpdate:modelValue"]),v(L,{size:"mini",icon:"delete-o",class:"border-none",onClick:m=>I(t.id),disabled:r(_).length<2},null,8,["onClick","disabled"])]),_:2},1024))),128))]),_:1})):E("",!0)])])}}}),ae={class:"delete-row"},ie=k({__name:"TableItem",props:{item:null},setup(a){const s=a,d=P(),_=d.friendsList,u=d.itemList,c=d.changeItemList,p=d.updateItem,I=V(()=>K({sum:s.item.price,divideBy:n.value.length})),n=z([]),o=z([]);j(_,()=>{const f=_.filter(e=>!o.value.includes(e.id));n.value=f.map(e=>e.id)},{immediate:!0}),j(I,f=>{p({id:s.item.itemId,debt:f})},{immediate:!0}),j(n,f=>{p({id:s.item.itemId,includedFriends:f})});const y=function(f){n.value.includes(f)?(n.value=n.value.filter(e=>e!==f),o.value.push(f)):(n.value.push(f),o.value=o.value.filter(e=>e===f))},L=()=>{c("remove",s.item.itemId)},F=(f,e)=>{p({id:s.item.itemId,field:f,value:e,debt:I.value,includedFriends:n.value})};return(f,e)=>{const t=b("van-field"),m=b("van-button");return l(),h("tr",null,[g("td",null,[v(t,{modelValue:s.item.itemName,"onUpdate:modelValue":e[0]||(e[0]=i=>F("itemName",i)),"left-icon":"cart-o","right-icon":"edit",placeholder:"Name"},null,8,["modelValue"])]),g("td",null,[v(t,{modelValue:s.item.price,"onUpdate:modelValue":e[1]||(e[1]=i=>F("price",+i)),type:"number",placeholder:"Price"},null,8,["modelValue"])]),(l(!0),h(D,null,N(r(_),i=>(l(),h("td",{key:i.id},[v(m,{type:n.value.includes(i.id)?"primary":"default",size:"mini",class:"debt-btn",onClick:S=>y(i.id)},{default:$(()=>[A(T(n.value.includes(i.id)?r(I):"-"),1)]),_:2},1032,["type","onClick"])]))),128)),g("td",ae,[v(m,{size:"mini",icon:"delete-o",class:"border-none",onClick:L,disabled:r(u).length<2},null,8,["disabled"])])])}}});const de=q(ie,[["__scopeId","data-v-ce2dbcab"]]),re={class:"item-table"},ce=g("th",null,"Item",-1),ue=g("th",null,"Price",-1),me=g("th",null,null,-1),_e=k({__name:"AddItemTable",setup(a){const s=P(),d=s.friendsList,_=s.itemList,u=s.changeItemList;return(c,p)=>{const I=b("van-button"),n=b("van-row"),o=b("van-form");return l(),x(o,{class:"add-item-view d-flex-center"},{default:$(()=>[g("table",re,[g("thead",null,[ce,ue,(l(!0),h(D,null,N(r(d),y=>(l(),h("th",{key:y.id},T(y.name),1))),128)),me]),g("tbody",null,[(l(!0),h(D,null,N(r(_),y=>(l(),x(de,{key:y.itemId,item:y},null,8,["item"]))),128))])]),v(n,{class:"mt-base"},{default:$(()=>[v(I,{icon:"plus",size:"mini",onClick:p[0]||(p[0]=y=>r(u)("add"))},{default:$(()=>[A("Add item")]),_:1})]),_:1})]),_:1})}}});const pe={key:0},fe=k({__name:"DebtItem",props:{friend:null},setup(a){const s=a,d=P(),{payer:_}=B(d),u=d.getFullDebts,c=V(()=>u(s.friend.id));return(p,I)=>{const n=b("van-collapse-item");return l(),x(n,{title:s.friend.name,value:`owes ${s.friend.debts} to ${r(_).name}`,name:s.friend.id},{default:$(()=>[r(c)?(l(),h("ul",pe,[(l(!0),h(D,null,N(r(c).debts,o=>(l(),h("li",{key:o.itemId},T(o.itemName)+" - "+T(o.debt),1))),128))])):E("",!0)]),_:1},8,["title","value","name"])}}}),ve=k({__name:"DebtList",setup(a){const s=P(),{simplifiedDebts:d,payer:_,paidSum:u,returnSum:c}=B(s),p=z("accordion");return(I,n)=>{const o=b("van-cell"),y=b("van-collapse"),L=b("van-cell-group");return l(),x(L,{class:"debtor-list mb-base",inset:""},{default:$(()=>[r(u)&&r(c)?(l(),x(o,{key:0,title:`${r(_).name} paid ${r(u)} and gets back ${r(c)}`},null,8,["title"])):E("",!0),v(y,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=F=>p.value=F),accordion:""},{default:$(()=>[(l(!0),h(D,null,N(r(d),F=>(l(),x(fe,{key:F.id,friend:F},null,8,["friend"]))),128))]),_:1},8,["modelValue"])]),_:1})}}});const be=q(ve,[["__scopeId","data-v-c646fd2f"]]),he={class:"group-wrapper"},ge={class:"group-wrapper mb-base"},Ie=k({__name:"ItemizedForm",setup(a){return(s,d)=>{const _=b("van-cell-group"),u=b("van-form");return l(),x(u,{class:"itemized-form"},{default:$(()=>[v(_,{inset:""},{default:$(()=>[v(le),g("div",he,[v(_e)]),g("div",ge,[v(be)])]),_:1})]),_:1})}}});const $e=k({__name:"CalcItemizedView",setup(a){return(s,d)=>(l(),x(Ie))}});export{$e as default};
